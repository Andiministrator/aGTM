// ssGTM Doku: https://developers.google.com/tag-platform/tag-manager/server-side/api?hl=de
// aGTM Doku: https://github.com/Andiministrator/aGTM
const aGTMversion = "1.4.1";

// Load Libraries
//const log = require('logToConsole');
const claimRequest = require('claimRequest');
const setResponseStatus = require('setResponseStatus');
const setResponseHeader = require('setResponseHeader');
const setResponseBody = require('setResponseBody');
const returnResponse = require('returnResponse');
const getRequestPath = require('getRequestPath');
const getRequestQueryParameters = require('getRequestQueryParameters');
const fromBase64 = require('fromBase64');
const JSON = require('JSON');

// Check for /aGTM.js Path
const rpath = getRequestPath();
if (rpath.length < 8 || rpath.slice(rpath.length - 8) !== '/aGTM.js') return;
//if (getRequestPath() !== '/aGTM.js') return;
// Get URL Request Parameters and id
const queryParameters = getRequestQueryParameters();
const id = queryParameters.id || null;
// Return if id is set but not allowed
if (id) {
    let id_allowed = false;
    for (const val of data.ids) {
        if (val.id===id) {
            id_allowed = true;
            break;
        }
    }
    if (!id_allowed) return;
}
// Claim Request
claimRequest();

// Build CMP Code
const cmp = data.cmp ? data.cmp : "";

// Build aGTM Config
const gtm = data.gtm;
const c = {};
// Build gtm object
if (data.gtm) {
    const gtm = {};
    for (const val of data.gtm) {
        if (val.gtm_id) {
            gtm[val.gtm_id] = {};
            if (!val.gtm_consent) gtm[val.gtm_id].noConsent = true;
            if (val.gtm_env) gtm[val.gtm_id].env = val.gtm_env;
            if (val.gtm_url) gtm[val.gtm_id].gtmURL = val.gtm_url;
        }
    }
    c.gtm = gtm;
}
// Add Consent Conditions
if (data.consent) {
    for (const val of data.consent) {
        c[val.consent_type] = val.consent_value;
    }
}
// Add other Consent Options
if (data.sendConsentEvent) c.sendConsentEvent = true;
if (data.useListener) c.useListener = true;
if (data.consent_events) c.consent_events = data.consent_events;
// Other Options
if (data.aPageview) c.aPageview = true;
if (data.vPageview) c.vPageview = true; // deprecated
if (data.vPageviews) c.vPageviews = true;
if (data.dlStateEvents) c.dlStateEvents = true;
if (data.gdl) c.gdl = data.gdl;
if (data.dlOrgPush) c.dlOrgPush = data.dlOrgPush; if (typeof c.dlOrgPush!='string' || c.dlOrgPush=='-') c.dlOrgPush = '';
if (data.nonce) c.nonce = data.nonce;
if (data.debug) c.debug = true;
// Build config string
const config = "aGTM.f.config(" + JSON.stringify(c) + ");";

// aGTM Code
const agtm = fromBase64('d2luZG93LmFHVE09d2luZG93LmFHVE18fHt9LHdpbmRvdy5hR1RNLmM9d2luZG93LmFHVE0uY3x8e30sd2luZG93LmFHVE0uZD13aW5kb3cuYUdUTS5kfHx7fSx3aW5kb3cuYUdUTS5mPXdpbmRvdy5hR1RNLmZ8fHt9LHdpbmRvdy5hR1RNLmw9d2luZG93LmFHVE0ubHx8W10sd2luZG93LmFHVE0ubj13aW5kb3cuYUdUTS5ufHx7fSxhR1RNLmYucHJvcHNldD1mdW5jdGlvbihlLHQsYSl7dHJ5e2VbdF09ZVt0XXx8YX1jYXRjaChlKXt9fSxhR1RNLmYub2JqaW5pdD1mdW5jdGlvbigpe1tbYUdUTS5kLCJ2ZXJzaW9uIiwiMS40LjEiXSxbYUdUTS5kLCJmIixbXV0sW2FHVE0uZCwiY29uZmlnIiwhMV0sW2FHVE0uZCwiaW5pdCIsITFdLFthR1RNLmQsImRvbV9yZWFkeSIsITFdLFthR1RNLmQsInBhZ2VfcmVhZHkiLCExXSxbYUdUTS5kLCJpc19pZnJhbWUiLHdpbmRvdy5zZWxmIT09d2luZG93LnRvcF0sW2FHVE0uZCwiZXZfZmN0X2N0ciIsMF0sW2FHVE0uZCwidGltZXIiLHt9XSxbYUdUTS5kLCJlcnJvcl9jb3VudGVyIiwwXSxbYUdUTS5kLCJlcnJvcnMiLFtdXSxbYUdUTS5kLCJkbCIsW11dLFthR1RNLmQsImlmcmFtZSIse2NvdW50ZXI6e2V2ZW50czowfSxvcmlnaW46IiIsaWZMaXN0ZW46ITEsdG9wTGlzdGVuOiExLGhhbmRzaGFrZTohMSx0aW1lcjpudWxsfV0sW2FHVE0uZCwibGFzdF91cmwiLGxvY2F0aW9uLmhyZWZdLFthR1RNLmYsInRsIix7fV0sW2FHVE0uZiwiZGwiLHt9XSxbYUdUTS5mLCJwbCIse31dLFthR1RNLCJsIixbXV0sW2FHVE0ubiwiY2siLCJjb29raWUiXSxbYUdUTS5uLCJ0bSIsImdvb2dsZXRhZ21hbmFnZXIiXSxbYUdUTS5uLCJ0YSIsInRhZ2Fzc2lzdGFudC5nb29nbGUiXV0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7YUdUTS5mLnByb3BzZXQoZVswXSxlWzFdLGVbMl0pfSkpfSxhR1RNLmYub2JqaW5pdCgpLGFHVE0uZi5sb2c9ZnVuY3Rpb24oZSx0KXt2YXIgYT0ib2JqZWN0Ij09dHlwZW9mIHQmJnQ/SlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0KSk6dDthR1RNLmwucHVzaCh7aWQ6ZSx0aW1lc3RhbXA6KG5ldyBEYXRlKS5nZXRUaW1lKCksb2JqOmF9KX0sYUdUTS5mLnN0cmNsZWFuPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lfHwib2JqZWN0Ij09dHlwZW9mIGUmJiFlPyIiOigic3RyaW5nIiE9dHlwZW9mIGUmJihlPWUudG9TdHJpbmcoKSksZS5yZXBsYWNlKC9bXmEtesOkw7bDvMOfQS1aw4TDlsOcMC05Xy1dL2csIiIpKX0sYUdUTS5mLnNTdHJmPWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8IWUpe3ZhciB0PUpTT04uc3RyaW5naWZ5KHtldmVudDoiZXhjZXB0aW9uIixlcnJtc2c6IkRhdGFMYXllciBFbnRyeSBpcyBubyBvYmplY3QiLGVycnR5cGU6IkRMIEVycm9yIixvYmpfdHlwZTp0eXBlb2YgZSxvYmpfdmFsdWU6ZX0pO3JldHVybiBhR1RNLmYubG9nKCJlMTYiLEpTT04ucGFyc2UodCkpLEpTT04uc3RyaW5naWZ5KG51bGwpfXZhciBhPVtdO3JldHVybiBKU09OLnN0cmluZ2lmeShlLChmdW5jdGlvbihlLHQpe2lmKCJvYmplY3QiPT10eXBlb2YgdCYmbnVsbCE9PXQpe2lmKC0xIT09YS5pbmRleE9mKHQpKXJldHVybiJbQ2lyY3VsYXJdIjthLnB1c2godCl9cmV0dXJuIHR9KSl9LGFHVE0uZi5hbj1mdW5jdGlvbihlLHQsYSxuKXtlW3RdPWEuaGFzT3duUHJvcGVydHkodCk/YVt0XTpufSxhR1RNLmYuY29uZmlnPWZ1bmN0aW9uKGUpe2lmKGFHVE0uZC5jb25maWcpImZ1bmN0aW9uIj09dHlwZW9mIGFHVE0uZi5sb2cmJmFHVE0uZi5sb2coImUxIixhR1RNLmMpO2Vsc2V7aWYoYUdUTS5mLmFuKGFHVE0uYywiZGVidWciLGUsITEpLGFHVE0uZi5hbihhR1RNLmMsInBhdGgiLGUsIiIpLGFHVE0uZi5hbihhR1RNLmMsImZpbGUiLGUsImFHVE0uanMiKSxhR1RNLmYuYW4oYUdUTS5jLCJjbXAiLGUsIiIpLGFHVE0uYy5taW49ImJvb2xlYW4iIT10eXBlb2YgZS5taW58fGUubWluLGFHVE0uZi5hbihhR1RNLmMsIm5vbmNlIixlLCIiKSxhR1RNLmYuYW4oYUdUTS5jLCJpZnJhbWVTdXBwb3J0IixlLCExKSxhR1RNLmYuYW4oYUdUTS5jLCJ2UGFnZXZpZXdzIixlLCExKSxhR1RNLmYuYW4oYUdUTS5jLCJ2UGFnZXZpZXdzVGltZXIiLGUsMCksYUdUTS5mLmFuKGFHVE0uYywidlBhZ2V2aWV3c0ZhbGxiYWNrIixlLCExKSxhR1RNLmYuYW4oYUdUTS5jLCJndG1JRCIsZSwiIiksZS5ndG0pZm9yKHZhciB0IGluIGUuZ3RtKWUuZ3RtLmhhc093blByb3BlcnR5KHQpJiYoYUdUTS5jLmd0bUlEPWFHVE0uYy5ndG1JRHx8dCxhR1RNLmMuZ3RtPWFHVE0uYy5ndG18fHt9LGFHVE0uYy5ndG1bdF09ZS5ndG1bdF18fHt9LGFHVE0uZi5hbihhR1RNLmMuZ3RtW3RdLCJub0NvbnNlbnQiLGUuZ3RtW3RdLCExKSxhR1RNLmYuYW4oYUdUTS5jLmd0bVt0XSwiZW52IixlLmd0bVt0XSwiIiksYUdUTS5mLmFuKGFHVE0uYy5ndG1bdF0sImlkUGFyYW0iLGUuZ3RtW3RdLCIiKSxhR1RNLmYuYW4oYUdUTS5jLmd0bVt0XSwiZ3RtVVJMIixlLmd0bVt0XSwiIiksYUdUTS5mLmFuKGFHVE0uYy5ndG1bdF0sImd0bUpTIixlLmd0bVt0XSwiIikpO2FHVE0uZi5hbihhR1RNLmMsImdkbCIsZSwiZGF0YUxheWVyIiksYUdUTS5mLmFuKGFHVE0uYywiZ3RtUHVycG9zZXMiLGUsIiIpLGFHVE0uZi5hbihhR1RNLmMsImd0bVNlcnZpY2VzIixlLCIiKSxhR1RNLmYuYW4oYUdUTS5jLCJndG1WZW5kb3JzIixlLCIiKSxhR1RNLmYuYW4oYUdUTS5jLCJndG1BdHRyIixlLG51bGwpLGFHVE0uZi5hbihhR1RNLmMsImRsU2V0IixlLHt9KSxhR1RNLmYuYW4oYUdUTS5jLCJ1c2VMaXN0ZW5lciIsZSwhMSksYUdUTS5mLmFuKGFHVE0uYywiZGxPcmdQdXNoIixlLCIiKSxhR1RNLmMuZGxTdGF0ZUV2ZW50cz0iYm9vbGVhbiI9PXR5cGVvZiBlLmRsU3RhdGVFdmVudHMmJmUuZGxTdGF0ZUV2ZW50cyxhR1RNLmMuYVBhZ2V2aWV3PSJib29sZWFuIj09dHlwZW9mIGUuYVBhZ2V2aWV3JiZlLmFQYWdldmlldyxhR1RNLmMudlBhZ2V2aWV3PSJib29sZWFuIj09dHlwZW9mIGUudlBhZ2V2aWV3JiZlLnZQYWdldmlldyxhR1RNLmMuc2VuZENvbnNlbnRFdmVudD0iYm9vbGVhbiI9PXR5cGVvZiBlLnNlbmRDb25zZW50RXZlbnQmJmUuc2VuZENvbnNlbnRFdmVudCxlLmNvbnNlbnQ9ZS5jb25zZW50fHx7fSxhR1RNLmMuY29uc2VudD1hR1RNLmMuY29uc2VudHx8ZS5jb25zZW50LGFHVE0uZi5hbihhR1RNLmMuY29uc2VudCwiaGFzUmVzcG9uc2UiLGUuY29uc2VudCwhMSksYUdUTS5mLmFuKGFHVE0uYy5jb25zZW50LCJmZWVkYmFjayIsZS5jb25zZW50LCIiKSxhR1RNLmYuYW4oYUdUTS5jLmNvbnNlbnQsInB1cnBvc2VzIixlLmNvbnNlbnQsIiIpLGFHVE0uZi5hbihhR1RNLmMuY29uc2VudCwic2VydmljZXMiLGUuY29uc2VudCwiIiksYUdUTS5mLmFuKGFHVE0uYy5jb25zZW50LCJ2ZW5kb3JzIixlLmNvbnNlbnQsIiIpLGFHVE0uZi5hbihhR1RNLmMuY29uc2VudCwiY29uc2VudF9pZCIsZS5jb25zZW50LCIiKSx3aW5kb3dbYUdUTS5jLmdkbF09d2luZG93W2FHVE0uYy5nZGxdfHxbXSxhR1RNLmQuY29uc2VudD1hR1RNLmQuY29uc2VudHx8SlNPTi5wYXJzZShhR1RNLmYuc1N0cmYoYUdUTS5jLmNvbnNlbnQpKSxhR1RNLmQuY29uc2VudC5ndG1Db25zZW50PSExLGFHVE0uZC5jb25maWc9ITAsYUdUTS5kLmd0bUxvYWRlZD1bXSwiZnVuY3Rpb24iPT10eXBlb2YgYUdUTS5mLmxvZyYmYUdUTS5mLmxvZygibTEiLGFHVE0uYyl9fSxhR1RNLmYubG9hZF9jYz1mdW5jdGlvbihlLHQpe3ZhciBhPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLG49YUdUTS5jLnBhdGh8fCIiO24ubGVuZ3RoPjAmJiIvIiE9PW4uY2hhckF0KG4ubGVuZ3RoLTEpJiYobis9Ii8iKTt2YXIgbz0iY21wL2NjXyIrYUdUTS5mLnN0cmNsZWFuKGUpKyhhR1RNLmMubWluPyIubWluIjoiIikrIi5qcyI7YS5zcmM9bitvLGFHVE0uYy5ub25jZSYmKGEubm9uY2U9YUdUTS5jLm5vbmNlKSxhLm9ucmVhZHlzdGF0ZWNoYW5nZT1hLm9ubG9hZD1mdW5jdGlvbigpe2EucmVhZHlTdGF0ZSYmIS9sb2FkZWR8Y29tcGxldGUvLnRlc3QoYS5yZWFkeVN0YXRlKXx8ImZ1bmN0aW9uIj09dHlwZW9mIHQmJnQoKX0sYS5hc3luYz0hMCxkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGEpfSxhR1RNLmYuY2hlbHA9ZnVuY3Rpb24oZSx0KXt2YXIgYT0hMDtyZXR1cm4gZSYmdCYmZS5zcGxpdCgiLCIpLmZvckVhY2goKGZ1bmN0aW9uKGUpe3QuaW5kZXhPZigiLCIrZS50cmltKCkrIiwiKTwwJiYoYT0hMSl9KSksYX0sYUdUTS5mLmV2YWxDb25zPWZ1bmN0aW9uKGUsdCl7dmFyIGlzQ29uc2VudEdpdmVuPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuZXZlcnkoKGZ1bmN0aW9uKGUpe3JldHVybiB0LmluZGV4T2YoIiwiK2UrIiwiKT49MH0pKX0sYT0hZS5wdXJwb3Nlcy5sZW5ndGh8fGlzQ29uc2VudEdpdmVuKGUucHVycG9zZXMsdC5wdXJwb3Nlcyksbj0hZS5zZXJ2aWNlcy5sZW5ndGh8fGlzQ29uc2VudEdpdmVuKGUuc2VydmljZXMsdC5zZXJ2aWNlcyksbz0hZS52ZW5kb3JzLmxlbmd0aHx8aXNDb25zZW50R2l2ZW4oZS52ZW5kb3JzLHQudmVuZG9ycyk7cmV0dXJuIGEmJm4mJm99LGFHVE0uZi5ydW5fY2M9ZnVuY3Rpb24oZSl7cmV0dXJuIGFHVE0uZC5jb25maWc/InN0cmluZyIhPXR5cGVvZiBlfHwiaW5pdCIhPT1lJiYidXBkYXRlIiE9PWU/KGFHVE0uZi5sb2coImU1Iix7YWN0aW9uOmV9KSwhMSk6ImZ1bmN0aW9uIiE9dHlwZW9mIGFHVE0uZi5jb25zZW50X2NoZWNrPyhhR1RNLmYubG9nKCJlMTQiLHthY3Rpb246ZX0pLCExKTphR1RNLmYuY29uc2VudF9jaGVjayhlKT8od2luZG93W2FHVE0uYy5nZGxdPXdpbmRvd1thR1RNLmMuZ2RsXXx8W10sYUdUTS5mLmNoZWxwKGFHVE0uYy5ndG1QdXJwb3NlcyxhR1RNLmQuY29uc2VudC5wdXJwb3NlcykmJmFHVE0uZi5jaGVscChhR1RNLmMuZ3RtU2VydmljZXMsYUdUTS5kLmNvbnNlbnQuc2VydmljZXMpJiZhR1RNLmYuY2hlbHAoYUdUTS5jLmd0bVZlbmRvcnMsYUdUTS5kLmNvbnNlbnQudmVuZG9ycyk/YUdUTS5kLmNvbnNlbnQuZ3RtQ29uc2VudD0hMDphR1RNLmQuY29uc2VudC5ndG1Db25zZW50PSJib29sZWFuIj09dHlwZW9mIGFHVE0uZC5jb25zZW50LmJsb2NrZWQmJmFHVE0uZC5jb25zZW50LmJsb2NrZWQsInVwZGF0ZSI9PWUmJihhR1RNLmQuaW5pdHx8YUdUTS5mLmluamVjdCgpLGFHVE0uZi5zZW5kbmF1cyh7ZXZlbnQ6ImFHVE1fY29uc2VudF91cGRhdGUiLGFHVE10czoobmV3IERhdGUpLmdldFRpbWUoKSxhR1RNY29uc2VudDphR1RNLmQuY29uc2VudD9KU09OLnBhcnNlKGFHVE0uZi5zU3RyZihhR1RNLmQuY29uc2VudCkpOnt9fSkpLCJmdW5jdGlvbiI9PXR5cGVvZiBhR1RNLmYuY29uc2VudF9jYWxsYmFjayYmYUdUTS5mLmNvbnNlbnRfY2FsbGJhY2soZSksYUdUTS5mLmxvZygibTMiLGFHVE0uZC5jb25zZW50KSwhMCk6KGFHVE0uZi5sb2coIm04IixudWxsKSwhMSk6KGFHVE0uZi5sb2coImU0IixudWxsKSwhMSl9LGFHVE0uZi5jYWxsX2NjPWZ1bmN0aW9uKCl7cmV0dXJuISgiZnVuY3Rpb24iIT10eXBlb2YgYUdUTS5mLnJ1bl9jY3x8IWFHVE0uZi5ydW5fY2MoImluaXQiKSkmJih2b2lkIDAhPT1hR1RNLmQudGltZXIuY29uc2VudCYmKGNsZWFySW50ZXJ2YWwoYUdUTS5kLnRpbWVyLmNvbnNlbnQpLGRlbGV0ZSBhR1RNLmQudGltZXIuY29uc2VudCksISFhR1RNLmQuaW5pdHx8YUdUTS5mLmluamVjdCgpKX0sImZ1bmN0aW9uIiE9dHlwZW9mIGFHVE0uZi5jb25zZW50X2xpc3RlbmVyJiYoYUdUTS5mLmNvbnNlbnRfbGlzdGVuZXI9ZnVuY3Rpb24oKXthR1RNLmMudXNlTGlzdGVuZXJ8fChhR1RNLmQudGltZXIuY29uc2VudD1zZXRJbnRlcnZhbChhR1RNLmYuY2FsbF9jYywxZTMpKX0pLGFHVE0uZi5nYz1mdW5jdGlvbihlKXt2YXIgdD1uZXcgUmVnRXhwKGUrIj0oW147XSspIiksYT1udWxsO3RyeXt2YXIgbj1kb2N1bWVudCxvPXQuZXhlYyhuW2FHVE0ubi5ja10pO28mJm8ubGVuZ3RoPjEmJihhPWRlY29kZVVSSUNvbXBvbmVudChvWzFdKSl9Y2F0Y2goZSl7fXJldHVybiBhfSxhR1RNLmYuc2M9ZnVuY3Rpb24oZSx0KXtpZigic3RyaW5nIj09dHlwZW9mIGUmJmUmJnQpdHJ5e2RvY3VtZW50W2FHVE0ubi5ja109ZSsiPSIrdCsiOyBTZWN1cmU7IFNhbWVTaXRlPUxheDsgcGF0aD0vIn1jYXRjaChlKXt9fSxhR1RNLmYudXJsUGFyYW09ZnVuY3Rpb24oZSx0KXt2YXIgYT1uZXcgUmVnRXhwKCJbPyZdIitlKyIoPShbXiYjXSopfCZ8I3wkKSIpLmV4ZWModCk7cmV0dXJuIGEmJmFbMl0/ZGVjb2RlVVJJQ29tcG9uZW50KGFbMl0ucmVwbGFjZSgvXCsvZywiICIpKTpudWxsfSxhR1RNLmYub3B0b3V0PWZ1bmN0aW9uKCl7dmFyIGU9ITEsdD1hR1RNLmYudXJsUGFyYW0oImFHVE1vcHRvdXQiLHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtpZih0JiYiMCIhPT10KWFHVE0uZi5zYygiYUdUTW9wdG91dCIsIjEiKSxlPSEwO2Vsc2UgaWYoIjAiPT09dClhR1RNLmYuc2MoImFHVE1vcHRvdXQiLCIwIik7ZWxzZXt2YXIgYT1hR1RNLmYuZ2MoImFHVE1vcHRvdXQiKTthJiYiMCIhPT1hJiYoZT0hMCl9aWYoZSl7Zm9yKHZhciBuIGluIGFHVE0pYUdUTS5oYXNPd25Qcm9wZXJ0eShuKSYmImYiIT09biYmZGVsZXRlIGFHVE1bbl07cmV0dXJuIGFHVE0uZi5vYmppbml0KCksImZ1bmN0aW9uIj09dHlwZW9mIGFHVE0uZi5vcHRvdXRfY2FsbGJhY2smJmFHVE0uZi5vcHRvdXRfY2FsbGJhY2soKSwhMH1yZXR1cm4hMX0sYUdUTS5mLmFHVE1fZXZlbnQ9ZnVuY3Rpb24oZSl7Im9iamVjdCIhPXR5cGVvZiBhR1RNLmQuY29uc2VudCYmKGFHVE0uZC5jb25zZW50PW51bGwpLGV8fChlPSJhR1RNX2V2ZW50Iik7dmFyIHQ9e2V2ZW50OmUsYUdUTXRzOihuZXcgRGF0ZSkuZ2V0VGltZSgpLGFHVE1jb25zZW50OmFHVE0uZC5jb25zZW50P0pTT04ucGFyc2UoYUdUTS5mLnNTdHJmKGFHVE0uZC5jb25zZW50KSk6e319O3JldHVybiJhR1RNX3JlYWR5Ij09ZSYmKHQuYUdUTT17dmVyc2lvbjphR1RNLmQudmVyc2lvbixpc19pZnJhbWU6YUdUTS5kLmlzX2lmcmFtZSxoYXN0eUV2ZW50czphR1RNLmQuZixlcnJvcnM6YUdUTS5kLmVycm9yc30pLHR9LGFHVE0uZi5wcm94eVN1cHBvcnQ9ZnVuY3Rpb24oKXtpZigiZnVuY3Rpb24iIT10eXBlb2YgUHJveHkpcmV0dXJuITE7dHJ5e3JldHVybiBuZXcgUHJveHkoKGZ1bmN0aW9uKCl7fSkse2FwcGx5OmZ1bmN0aW9uKCl7cmV0dXJuITB9fSkoKX1jYXRjaChlKXtyZXR1cm4hMX19LGFHVE0uZi51cmxMaXN0ZW5lcj1mdW5jdGlvbihlLHQsYSl7Y29uc29sZS5sb2coIlVSTCBMaXN0ZW5lciBzdGFydGVkIix7ZXZlbnRuYW1lOmUsaW50ZXJ2YWw6dCxmYWxsYmFjazphfSksIm51bWJlciIhPXR5cGVvZiB0JiYodD01MDApLCJib29sZWFuIiE9dHlwZW9mIGEmJihhPSExKSxhR1RNLmQubGFzdF91cmw9YUdUTS5kLmxhc3RfdXJsfHxhR1RNLmYuZ2V0VmFsKCJsIiwiaHJlZiIpLCJzdHJpbmciPT10eXBlb2YgYUdUTS5kLmxhc3RfdXJsJiZhR1RNLmQubGFzdF91cmx8fChhR1RNLmQubGFzdF91cmw9IiIpO3ZhciBjaGVja1VybENoYW5nZT1mdW5jdGlvbigpe3ZhciB0PWFHVE0uZi5nZXRWYWwoImwiLCJocmVmIil8fCIiO2lmKHQhPWFHVE0uZC5sYXN0X3VybCl7InN0cmluZyIhPXR5cGVvZiBlJiYoZT0idlBhZ2V2aWV3Iik7dmFyIGE9e2V2ZW50OmV9O2Eub2xkVVJMPWFHVE0uZC5sYXN0X3VybCxhLm5ld1VSTD10LGEubmV3VGl0bGU9ZG9jdW1lbnQudGl0bGUsYUdUTS5mLmZpcmUoYSksYUdUTS5kLmxhc3RfdXJsPXR9fTthR1RNLmYuZXZMc3RuKCJ3aW5kb3ciLCJwb3BzdGF0ZSIsY2hlY2tVcmxDaGFuZ2UpLGFHVE0uZi5ldkxzdG4oIndpbmRvdyIsImhhc2hjaGFuZ2UiLGNoZWNrVXJsQ2hhbmdlKTt2YXIgbj0hMTtpZihhR1RNLmYucHJveHlTdXBwb3J0KXt2YXIgbz17YXBwbHk6ZnVuY3Rpb24oZSx0LGEpe3ZhciBuPWUuYXBwbHkodCxhKTtyZXR1cm4gY2hlY2tVcmxDaGFuZ2UoKSxufX07aGlzdG9yeS5wdXNoU3RhdGU9bmV3IFByb3h5KGhpc3RvcnkucHVzaFN0YXRlLG8pLGhpc3RvcnkucmVwbGFjZVN0YXRlPW5ldyBQcm94eShoaXN0b3J5LnJlcGxhY2VTdGF0ZSxvKSxuPSEwfSh0PjAmJiFuJiZhfHx0PjAmJiFhKSYmYUdUTS5mLnRpbWVyKCJ1cmxMaXN0ZW5lciIsY2hlY2tVcmxDaGFuZ2UsbnVsbCx0LDApfSxhR1RNLmYuZ3RtX2xvYWQ9ZnVuY3Rpb24oZSx0LGEsbixvLHIpe2lmKGFHVE0uZC5jb25maWcpe2lmKCJvYmplY3QiIT10eXBlb2YgYUdUTS5kLmd0bUxvYWRlZCYmKGFHVE0uZC5ndG1Mb2FkZWQ9W10pLGFHVE0uZC5ndG1Mb2FkZWQubGVuZ3RoPDEmJihhR1RNLmYuc2VuZG5hdXMoYUdUTS5mLmFHVE1fZXZlbnQoImFHVE1fcmVhZHkiKSksYSYmYUdUTS5mLnNlbmRuYXVzKHtldmVudDoiZ3RtLmpzIiwiZ3RtLnN0YXJ0IjoobmV3IERhdGUpLmdldFRpbWUoKX0pLGFHVE0uYy5hUGFnZXZpZXcmJmFHVE0uZi5zZW5kbmF1cyh7ZXZlbnQ6ImFQYWdldmlldyIsYUdUTXRzOihuZXcgRGF0ZSkuZ2V0VGltZSgpfSksYUdUTS5jLnZQYWdldmlldyYmYUdUTS5mLnNlbmRuYXVzKHtldmVudDoidlBhZ2V2aWV3IixhR1RNdHM6KG5ldyBEYXRlKS5nZXRUaW1lKCl9KSxhR1RNLmMudlBhZ2V2aWV3cyYmYUdUTS5mLnVybExpc3RlbmVyKCJ2UGFnZXZpZXciLGFHVE0uYy52UGFnZXZpZXdzVGltZXIsYUdUTS5jLnZQYWdldmlld3NGYWxsYmFjaykpLGFHVE0uZC5jb25zZW50RXZlbnRfZmlyZWQ9ImJvb2xlYW4iPT10eXBlb2YgYUdUTS5kLmNvbnNlbnRFdmVudF9maXJlZCYmYUdUTS5kLmNvbnNlbnRFdmVudF9maXJlZCxhR1RNLmMuc2VuZENvbnNlbnRFdmVudCYmIWFHVE0uZC5jb25zZW50RXZlbnRfZmlyZWQmJiJvYmplY3QiPT10eXBlb2YgYUdUTS5kLmNvbnNlbnQmJmFHVE0uZC5jb25zZW50Lmhhc1Jlc3BvbnNlJiYoYUdUTS5mLnNlbmRuYXVzKGFHVE0uZi5hR1RNX2V2ZW50KCJhR1RNX2NvbnNlbnQiKSksYUdUTS5kLmNvbnNlbnRFdmVudF9maXJlZD0hMCksYSl7bnx8KG49ImlkIik7dmFyIGk9ITEsYz1hR1RNLmYuZ2MoImFHVE1kZWJ1ZyIpO2lmKGMmJnBhcnNlSW50KGMpPjAmJihpPSEwKSwhaSl7dmFyIGY9bmV3IFVSTChkb2N1bWVudC5sb2NhdGlvbi5ocmVmKTthR1RNLmYudXJsUGFyYW0oImd0bV9kZWJ1ZyIsZikmJihpPSEwKX1pZighaSYmZG9jdW1lbnQucmVmZXJyZXIpKGY9bmV3IFVSTChkb2N1bWVudC5yZWZlcnJlcikpLmhvc3RuYW1lPT1hR1RNLm4udGErIi5jb20iJiYoaT0hMCk7IWMmJmkmJmFHVE0uZi5zYygiYUdUTWRlYnVnIiwiMSIpO3ZhciBzPXQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7aWYocy5pZD0iYUdUTV90bV8iK2Escy5hc3luYz0hMCwib2JqZWN0Ij09dHlwZW9mIGFHVE0uYy5ndG1BdHRyKWZvcih2YXIgVCBpbiBhR1RNLmMuZ3RtQXR0cilzLnNldEF0dHJpYnV0ZShULGFHVE0uYy5ndG1BdHRyW1RdKTtpZihhR1RNLmMubm9uY2UmJihzLm5vbmNlPWFHVE0uYy5ub25jZSksci5ndG1KUyYmIWkpcy5pbm5lckhUTUw9YXRvYihyLmd0bUpTKTtlbHNle3ZhciBNPXIuZ3RtVVJMfHwiaHR0cHM6Ly93d3cuIithR1RNLm4udG0rIi5jb20vZ3RtLmpzIixHPXIuZW52fHwiIixkPS0xPT09TS5pbmRleE9mKCI/Iik/Ij8iOiImIjtzLnNyYz1NK2QrbisiPSIrYSsiJmw9IitvK0d9dmFyIGw9dC5nZXRFbGVtZW50c0J5VGFnTmFtZSgic2NyaXB0IilbMF07bC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzLGwpLGFHVE0uZC5ndG1Mb2FkZWQucHVzaChhfHwibm9fZ3RtX2lkIil9fWVsc2UgYUdUTS5mLmxvZygiZTciLG51bGwpfSxhR1RNLmYuZG9tcmVhZHk9ZnVuY3Rpb24oZSl7dmFyIHQ9ITE7YUdUTS5mLnZPYihlKXx8KGU9e2FNU0c6IkVtcHR5IERPTXJlYWR5IGV2ZW50IGZpcmVkLiJ9LHQ9ITApLGUuZXZlbnR8fChlLmV2ZW50PSJhRE9NcmVhZHkiKSxhR1RNLmQuZG9tX3JlYWR5JiZ0fHwoIWFHVE0uYy5kbFN0YXRlRXZlbnRzJiZ0fHxhR1RNLmYuZmlyZShlKSx0JiYoYUdUTS5kLmRvbV9yZWFkeT0hMCkpfSxhR1RNLmYucGFnZXJlYWR5PWZ1bmN0aW9uKGUpe3ZhciB0PSExO2FHVE0uZi52T2IoZSl8fChlPXthTVNHOiJFbXB0eSBQQUdFcmVhZHkgZXZlbnQgZmlyZWQuIn0sdD0hMCksZS5ldmVudHx8KGUuZXZlbnQ9ImFQQUdFcmVhZHkiKSxhR1RNLmQucGFnZV9yZWFkeSYmdHx8KCFhR1RNLmMuZGxTdGF0ZUV2ZW50cyYmdHx8YUdUTS5mLmZpcmUoZSksdCYmKGFHVE0uZC5wYWdlX3JlYWR5PSEwKSl9LGFHVE0uZi5pbml0R1RNPWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiPT10eXBlb2YgYUdUTS5jLmd0bSYmYUdUTS5jLmd0bSl7dmFyIHQ9MDtmb3IodmFyIGEgaW4gYUdUTS5jLmd0bSl0KyssYUdUTS5jLmd0bS5oYXNPd25Qcm9wZXJ0eShhKSYmKCJib29sZWFuIiE9dHlwZW9mIGFHVE0uYy5ndG1bYV0uaGFzTG9hZGVkJiYoYUdUTS5jLmd0bVthXS5oYXNMb2FkZWQ9ITEpLGFHVE0uYy5ndG1bYV0uaGFzTG9hZGVkfHxlJiYhYUdUTS5jLmd0bVthXS5ub0NvbnNlbnR8fChhR1RNLmYuZ3RtX2xvYWQod2luZG93LGRvY3VtZW50LGEsYUdUTS5jLmd0bVthXS5pZFBhcmFtP2FHVE0uYy5ndG1bYV0uaWRQYXJhbToiIixhR1RNLmMuZ2RsLGFHVE0uYy5ndG1bYV0pLGFHVE0uYy5ndG1bYV0uaGFzTG9hZGVkPSEwKSk7dHx8YUdUTS5mLmd0bV9sb2FkKHdpbmRvdyxkb2N1bWVudCwiIixhR1RNLmMuZ3RtW2FdLmlkUGFyYW0/YUdUTS5jLmd0bVthXS5pZFBhcmFtOiIiLGFHVE0uYy5nZGwsbnVsbCl9fSxhR1RNLmYuY2hrRFByZWFkeT1mdW5jdGlvbigpe3ZhciBlPWRvY3VtZW50LnJlYWR5U3RhdGU7ImludGVyYWN0aXZlIj09PWV8fCJjb21wbGV0ZSI9PT1lP2FHVE0uZi5kb21yZWFkeShudWxsKTphR1RNLmYuZXZMc3RuKGRvY3VtZW50LCJET01Db250ZW50TG9hZGVkIixhR1RNLmYuZG9tcmVhZHkpLCJjb21wbGV0ZSI9PT1lP2FHVE0uZi5wYWdlcmVhZHkobnVsbCk6YUdUTS5mLmV2THN0bih3aW5kb3csImxvYWQiLGFHVE0uZi5wYWdlcmVhZHkpfSxhR1RNLmYuaW5qZWN0PWZ1bmN0aW9uKCl7aWYoIWFHVE0uZC5jb25maWcpcmV0dXJuIGFHVE0uZi5sb2coImU4IixudWxsKSwhMTtpZigib2JqZWN0IiE9dHlwZW9mIGFHVE0uZC5jb25zZW50fHwiYm9vbGVhbiIhPXR5cGVvZiBhR1RNLmQuY29uc2VudC5oYXNSZXNwb25zZXx8IWFHVE0uZC5jb25zZW50Lmhhc1Jlc3BvbnNlKXJldHVybiBhR1RNLmYubG9nKCJlMTMiLG51bGwpLCExO2FHVE0uZC5pbml0fHwoKHdpbmRvd1thR1RNLmMuZ2RsXXx8W10pLmZvckVhY2goKGZ1bmN0aW9uKGUsdCl7aWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlKXtpZighZS5hR1RNY2hrKXtlLmFHVE1kbD0hMDt2YXIgYT1KU09OLnBhcnNlKGFHVE0uZi5zU3RyZihlKSk7dm9pZCAwIT09YVsiZ3RtLnVuaXF1ZUV2ZW50SWQiXSYmZGVsZXRlIGFbImd0bS51bmlxdWVFdmVudElkIl0sYUdUTS5kLmYucHVzaChhKX19ZWxzZSBhR1RNLmYubG9nKCJlMTciLHtvYmpfdHlwZTp0eXBlb2YgZSxvYmpfdmFsdWU6ZSxpbmRleDp0fSksYUdUTS5kLmYucHVzaCh7ZXZlbnQ6ImV4Y2VwdGlvbiIsZXJybXNnOiJEYXRhTGF5ZXIgRW50cnkgaXMgbm8gb2JqZWN0IixlcnJ0eXBlOiJETCBFcnJvciIsb2JqX3R5cGU6dHlwZW9mIGUsb2JqX3ZhbHVlOmV9KX0pKSxhR1RNLmQuY29uc2VudC5ndG1Db25zZW50JiYoYUdUTS5mLmluaXRHVE0oITEpLGFHVE0uZC5pbml0PSEwKSxhR1RNLmQuaW5pdCYmYUdUTS5mLmNoa0RQcmVhZHkoKSk7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIGFHVE0uZi5pbmplY3RfY2FsbGJhY2smJmFHVE0uZi5pbmplY3RfY2FsbGJhY2soKSxhR1RNLmYubG9nKCJtNiIsbnVsbCksITB9LGFHVE0uZi5pRnJhbWVGaXJlPWZ1bmN0aW9uKGUpeyJvYmplY3QiPT10eXBlb2YgZSYmZSYmKGFHVE0uZC5pc19pZnJhbWUmJiJzdHJpbmciPT10eXBlb2YgZS5ldmVudCYmL14oYUdUTXxndG1cLnxbYXZdRE9NcmVhZHl8W2F2XVBBR0VyZWFkeSkvLnRlc3QoZS5ldmVudCk/YUdUTS5mLnNlbmRuYXVzKGUpOihlLmFHVE1fc291cmNlPSJpRnJhbWUgIitkb2N1bWVudC5sb2NhdGlvbi5ob3N0bmFtZSxhR1RNLmQuaWZyYW1lLmNvdW50ZXIuZXZlbnRzKyssZS5pZkV2Q3RyPWFHVE0uZC5pZnJhbWUuY291bnRlci5ldmVudHMsInN0cmluZyI9PXR5cGVvZiBlLmV2ZW50JiZlLmV2ZW50JiYoYUdUTS5kLmlmcmFtZS5jb3VudGVyW2UuZXZlbnRdPWFHVE0uZC5pZnJhbWUuY291bnRlcltlLmV2ZW50XXx8MCxhR1RNLmQuaWZyYW1lLmNvdW50ZXJbZS5ldmVudF0rKyxlWyJpZkV2Q3RyXyIrZS5ldmVudF09YUdUTS5kLmlmcmFtZS5jb3VudGVyW2UuZXZlbnRdKSxlLmFHVE10cyYmZGVsZXRlIGUuYUdUTXRzLGUuYUdUTXBhcmFtcyYmZGVsZXRlIGUuYUdUTXBhcmFtcyxhR1RNLmQuaWZyYW1lLm9yaWdpbj93aW5kb3cudG9wLnBvc3RNZXNzYWdlKGUsYUdUTS5kLmlmcmFtZS5vcmlnaW4pOmFHVE0uZC5mLnF1ZXVlLnB1c2goZSkpKX0sYUdUTS5mLmlmSGFuZHNoYWtlPWZ1bmN0aW9uKCl7aWYoIWFHVE0uZC5pc19pZnJhbWUmJiFhR1RNLmQuaWZyYW1lLmhhbmRzaGFrZSl7dmFyIGU9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlmcmFtZSIpO2lmKCFlLmxlbmd0aClyZXR1cm47Zm9yKHZhciB0PTA7dDxlLmxlbmd0aDt0Kyspe3ZhciBhPWVbdF07YSYmYS5jb250ZW50V2luZG93JiZhLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UmJmEuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSgiYUdUTV9Ub3AyaUZyYW1lIEhhbmRzaGFrZSIsIioiKX1hR1RNLmQuaWZyYW1lLmhhbmRzaGFrZT0hMH19LGFHVE0uZi5pZkhTbGlzdGVuPWZ1bmN0aW9uKGUpe2lmKGFHVE0uZC5pc19pZnJhbWUmJiJzdHJpbmciPT10eXBlb2YgZS5kYXRhJiYiYUdUTV9Ub3AyaUZyYW1lIEhhbmRzaGFrZSI9PWUuZGF0YSlmb3IoYUdUTS5kLmlmcmFtZS5vcmlnaW49ZS5vcmlnaW4sYUdUTS5kLmlmcmFtZS5pZkxpc3Rlbj0hMSx3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsYUdUTS5mLmlmSFNsaXN0ZW4sITEpO2FHVE0uZC5mLmxlbmd0aDspe3ZhciB0PWFHVE0uZC5mLnNoaWZ0KCk7YUdUTS5mLmlGcmFtZUZpcmUodCl9fSxhR1RNLmYudk9iPWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8IWUpcmV0dXJuITE7dHJ5e0pTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZSkpfWNhdGNoKGUpe3JldHVybiExfXJldHVybiEwfSxhR1RNLmYudlN0PWZ1bmN0aW9uKGUpe3ZhciB0PUFycmF5LmlzQXJyYXkoZSk/ZToic3RyaW5nIj09dHlwZW9mIGU/W2VdOltdO3JldHVybiAwIT09dC5sZW5ndGgmJnQuZXZlcnkoKGZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZSYmIiIhPT1lfSkpfSxhR1RNLmYuZXZMc3RuPWZ1bmN0aW9uKGUsdCxhKXtpZigid2luZG93Ij09PWUmJihlPXdpbmRvdyksImRvY3VtZW50Ij09PWUmJihlPWRvY3VtZW50KSwib2JqZWN0Ij09dHlwZW9mIGUmJmUmJiJzdHJpbmciPT10eXBlb2YgdCYmImZ1bmN0aW9uIj09dHlwZW9mIGEpdHJ5eyJtZXNzYWdlIj09dD9hR1RNLmQuaWZyYW1lLnRvcExpc3Rlbnx8YUdUTS5kLmlzX2lmcmFtZXx8KGFHVE0uZC5pZnJhbWUudG9wTGlzdGVuPSEwLGUuYWRkRXZlbnRMaXN0ZW5lcih0LChmdW5jdGlvbihlKXthKHZvaWQgMCE9PWUuZGF0YT9lLmRhdGE6bnVsbCwic3RyaW5nIj09dHlwZW9mIGUub3JpZ2luP2Uub3JpZ2luOiIiKX0pKSk6ZS5hZGRFdmVudExpc3RlbmVyKHQsYSl9Y2F0Y2gobil7YUdUTS5mLmxvZygiZTEyIix7ZXJyb3I6bixlbDplLGV2OnQsZmN0OmF9KX1lbHNlIGFHVE0uZi5sb2coImUxMSIse2VsOmUsZXY6dCxmY3Q6YX0pfSxhR1RNLmYucm1Mc3RuPWZ1bmN0aW9uKGUsdCxhKXsid2luZG93Ij09PWUmJihlPXdpbmRvdyksImRvY3VtZW50Ij09PWUmJihlPWRvY3VtZW50KTt0cnl7ZS5yZW1vdmVFdmVudExpc3RlbmVyKHQsYSl9Y2F0Y2goZSl7fX0sYUdUTS5mLmdldFZhbD1mdW5jdGlvbihlLHQpe2lmKGFHVE0uZi52U3QoW2UsdF0pJiZ0Lm1hdGNoKC9bYS16XSsvaSkmJigicCIhPWV8fCJvYmplY3QiPT10eXBlb2YgcGVyZm9ybWFuY2UmJnBlcmZvcm1hbmNlKSlzd2l0Y2goZSl7Y2FzZSJ3IjpyZXR1cm4gYUdUTS5mLnZPYih3aW5kb3dbdF0pP0pTT04ucGFyc2UoYUdUTS5mLnNTdHJmKHdpbmRvd1t0XSkpOndpbmRvd1t0XTtjYXNlIm4iOnJldHVybiBhR1RNLmYudk9iKG5hdmlnYXRvclt0XSk/SlNPTi5wYXJzZShhR1RNLmYuc1N0cmYobmF2aWdhdG9yW3RdKSk6bmF2aWdhdG9yW3RdO2Nhc2UiZCI6cmV0dXJuIGRvY3VtZW50W3RdO2Nhc2UibCI6cmV0dXJuIGRvY3VtZW50LmxvY2F0aW9uW3RdO2Nhc2UiaCI6cmV0dXJuIGRvY3VtZW50LmhlYWRbdF07Y2FzZSJiIjpyZXR1cm4gZG9jdW1lbnQuYm9keVt0XTtjYXNlInMiOnJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaHRtbCIpWzBdLnNjcm9sbFRvcHx8MDtjYXNlIm0iOnJldHVybiB3aW5kb3cuc2NyZWVuW3RdO2Nhc2UiYyI6cmV0dXJuIHdpbmRvdy5nb29nbGVfdGFnX2RhdGEmJndpbmRvdy5nb29nbGVfdGFnX2RhdGEuaWNzP0pTT04ucGFyc2UoYUdUTS5mLnNTdHJmKHdpbmRvdy5nb29nbGVfdGFnX2RhdGEuaWNzKSk6bnVsbDtjYXNlInAiOnJldHVybiJub3ciPT10P3BlcmZvcm1hbmNlLm5vdygpOnBlcmZvcm1hbmNlW3RdO2RlZmF1bHQ6cmV0dXJufX0sYUdUTS5mLmdldE5vZGVBdHRyPWZ1bmN0aW9uKGUsdCl7dmFyIGE9ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlKTtyZXR1cm4gYT9hLmdldEF0dHJpYnV0ZSh0KTpudWxsfSxhR1RNLmYubmV3Tm9kZT1mdW5jdGlvbihlLHQsYSl7aWYoYUdUTS5mLnZTdChbZSx0XSkmJiJvYmplY3QiPT10eXBlb2YgYSl7dmFyIG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlKSxvPWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodCk7aWYobyl7Zm9yKHZhciByIGluIGEpaWYoYS5oYXNPd25Qcm9wZXJ0eShyKSl7dmFyIGk9ci5zcGxpdCgiLiIpOzE9PT1pLmxlbmd0aD9uLnNldEF0dHJpYnV0ZShyLGFbcl0pOihuW2lbMF1dfHwobltpWzBdXT17fSksbltpWzBdXVtpWzFdXT1hW3JdKX1vLmFwcGVuZENoaWxkKG4pfX19LGFHVE0uZi5kZWxOb2RlPWZ1bmN0aW9uKGUpe2lmKGFHVE0uZi52U3QoZSkpe3ZhciB0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSk7dCYmdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHQpfX0sYUdUTS5mLnBhZ2VpbmZvPWZ1bmN0aW9uKGUpe3ZhciB0PTAsYT0wO2lmKChlPWV8fHt9KS5jb3VudFdvcmRzJiZmdW5jdGlvbiBnZXRUZXh0KGUpe2lmKDM9PT1lLm5vZGVUeXBlKXQrPWUudGV4dENvbnRlbnQudHJpbSgpLnNwbGl0KC9ccysvKS5sZW5ndGg7ZWxzZSBpZigxPT09ZS5ub2RlVHlwZSYmIS9eKHNjcmlwdHxzdHlsZXxub3NjcmlwdCkkL2kudGVzdChlLnRhZ05hbWUpKWZvcih2YXIgYT0wO2E8ZS5jaGlsZE5vZGVzLmxlbmd0aDthKyspZ2V0VGV4dChlLmNoaWxkTm9kZXNbYV0pfShkb2N1bWVudC5ib2R5KSxlLmNvdW50SW1hZ2VzKWZvcih2YXIgbj1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW1nIiksbz0wO288bi5sZW5ndGg7bysrKW5bb10ubmF0dXJhbFdpZHRoPjI1MCYmbltvXS5uYXR1cmFsSGVpZ2h0PjI1MCYmYSsrO3JldHVybnt3b3Jkczp0LGltYWdlczphfX0sYUdUTS5mLmNwTHN0PWZ1bmN0aW9uKGUsdCxhKXt0cnl7ZS5hZGRFdmVudExpc3RlbmVyKHQsKGZ1bmN0aW9uKGUpe3ZhciB0O3dpbmRvdy5nZXRTZWxlY3Rpb24mJih0PXdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpKSYmYSh0KX0pKX1jYXRjaCh0KXthR1RNLmYubG9nKCJlMTIiLHtlbGVtZW50OmUsZXJyb3I6dH0pfX0sYUdUTS5mLmVsTHN0PWZ1bmN0aW9uKGUsdCxhKXt0cnl7ZS5hZGRFdmVudExpc3RlbmVyKHQsKGZ1bmN0aW9uKGUpe2Zvcih2YXIgdD10aGlzLnRhZ05hbWUudG9Mb3dlckNhc2UoKSxuPSIiLG89IiIscj1udWxsLGk9bnVsbCxjPTAsZj10aGlzO2YmJmYucGFyZW50RWxlbWVudDspZj1mLnBhcmVudEVsZW1lbnQsIW4mJmYuaWQmJihuPSgic3RyaW5nIj09dHlwZW9mIGYubm9kZU5hbWU/Zi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKyI6IjoiIikrZi5pZCksIW8mJmYuZ2V0QXR0cmlidXRlKCJjbGFzcyIpJiYobz0oInN0cmluZyI9PXR5cGVvZiBmLm5vZGVOYW1lP2Yubm9kZU5hbWUudG9Mb3dlckNhc2UoKSsiOiI6IiIpK2YuZ2V0QXR0cmlidXRlKCJjbGFzcyIpKTtpZigiaW5wdXQiPT09dHx8InNlbGVjdCI9PT10fHwidGV4dGFyZWEiPT09dCl7Zm9yKGY9dGhpcztmJiZmLnBhcmVudEVsZW1lbnQmJiJmb3JtIiE9PWYudGFnTmFtZS50b0xvd2VyQ2FzZSgpOylmPWYucGFyZW50RWxlbWVudDsiZm9ybSI9PT1mLnRhZ05hbWUudG9Mb3dlckNhc2UoKSYmKHI9e2lkOmYuaWQsY2xhc3M6Zi5nZXRBdHRyaWJ1dGUoImNsYXNzIiksbmFtZTpmLmdldEF0dHJpYnV0ZSgibmFtZSIpLGFjdGlvbjpmLmFjdGlvbixlbGVtZW50czpmLmVsZW1lbnRzLmxlbmd0aH0saT1BcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGYuZWxlbWVudHMsdGhpcykrMSl9Im9iamVjdCI9PXR5cGVvZiB0aGlzLmVsZW1lbnRzJiYibnVtYmVyIj09dHlwZW9mIHRoaXMuZWxlbWVudHMubGVuZ3RoJiYoYz10aGlzLmVsZW1lbnRzLmxlbmd0aCk7dmFyIHM9e3RhZ05hbWU6dCx0YXJnZXQ6dGhpcy50YXJnZXR8fCIiLHBhcmVudElEOm4scGFyZW50Q2xhc3M6byxpZDp0aGlzLmlkfHwiIixuYW1lOnRoaXMuZ2V0QXR0cmlidXRlKCJuYW1lIil8fCIiLGNsYXNzOnRoaXMuZ2V0QXR0cmlidXRlKCJjbGFzcyIpfHwiIixocmVmOnRoaXMuaHJlZnx8IiIsc3JjOnRoaXMuc3JjfHwiIixhY3Rpb246dGhpcy5hY3Rpb258fCIiLHR5cGU6dGhpcy50eXBlfHwiIixlbGVtZW50czpjLHBvc2l0aW9uOmksZm9ybTpyLGh0bWw6dGhpcy5vdXRlckhUTUw/dGhpcy5vdXRlckhUTUwudG9TdHJpbmcoKToiIix0ZXh0OnRoaXMub3V0ZXJUZXh0P3RoaXMub3V0ZXJUZXh0LnRvU3RyaW5nKCk6IiJ9O3MuaHRtbC5sZW5ndGg+NTEyJiYocy5odG1sPXMuaHRtbC5zbGljZSgwLDUwOSkrIi4uLiIpLHMudGV4dC5sZW5ndGg+NTEyJiYocy50ZXh0PXMudGV4dC5zbGljZSgwLDUwOSkrIi4uLiIpLGEocyl9KSl9Y2F0Y2godCl7YUdUTS5mLmxvZygiZTEyIix7ZWxlbWVudDplLGVycm9yOnR9KX19LGFHVE0uZi5hZGRFbExzdD1mdW5jdGlvbihlLHQsYSl7aWYoYUdUTS5mLnZTdChbZSx0XSkmJiJmdW5jdGlvbiI9PXR5cGVvZiBhKXt2YXIgbj1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGUpOyJvYmplY3QiPT10eXBlb2YgbiYmIm51bWJlciI9PXR5cGVvZiBuLmxlbmd0aCYmMCE9bi5sZW5ndGgmJm4uZm9yRWFjaCgoZnVuY3Rpb24oZSl7aWYoImNvcHkiPT09dClhR1RNLmYuY3BMc3QoZSx0LGEpO2Vsc2UgYUdUTS5mLmVsTHN0KGUsdCxhKX0pKX19LGFHVE0uZi5vYnNlcnZlcj1mdW5jdGlvbihlLHQsYSl7aWYoYUdUTS5mLnZTdChbZSx0XSkmJiJmdW5jdGlvbiI9PXR5cGVvZiBhKXtuZXcgTXV0YXRpb25PYnNlcnZlcigoZnVuY3Rpb24obil7bi5mb3JFYWNoKChmdW5jdGlvbihuKXsiY2hpbGRMaXN0Ij09PW4udHlwZSYmbi5hZGRlZE5vZGVzLmxlbmd0aCYmQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChuLmFkZGVkTm9kZXMsKGZ1bmN0aW9uKG4pe2lmKDE9PT1uLm5vZGVUeXBlJiYic3RyaW5nIj09dHlwZW9mIG4udGFnTmFtZSYmbi50YWdOYW1lLnRvTG93ZXJDYXNlKCk9PT1lLnRvTG93ZXJDYXNlKCkmJmFHVE0uZi5lbExzdChuLHQsYSksMT09PW4ubm9kZVR5cGUmJm4ucXVlcnlTZWxlY3RvckFsbCl7dmFyIG89bi5xdWVyeVNlbGVjdG9yQWxsKGUudG9Mb3dlckNhc2UoKSk7QXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChvLChmdW5jdGlvbihlKXthR1RNLmYuZWxMc3QoZSx0LGEpfSkpfX0pKX0pKX0pKS5vYnNlcnZlKGRvY3VtZW50LmJvZHkse2NoaWxkTGlzdDohMCxzdWJ0cmVlOiEwLGF0dHJpYnV0ZXM6ITF9KX19LGFHVE0uZi5yVGVzdD1mdW5jdGlvbihlLHQpe3JldHVybiBhR1RNLmYudlN0KFtlLHRdKSYmbmV3IFJlZ0V4cCh0LCJpIikudGVzdChlKX0sYUdUTS5mLnJNYXRjaD1mdW5jdGlvbihlLHQpe3JldHVybiBlLm1hdGNoKG5ldyBSZWdFeHAodCkpfSxhR1RNLmYuclJlcGxhY2U9ZnVuY3Rpb24oZSx0LGEpe3JldHVybiBhR1RNLmYudlN0KFtlLHQsYV0pP2UucmVwbGFjZShuZXcgUmVnRXhwKHQsImdpIiksYSk6ZX0sYUdUTS5mLmlzSUZyYW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHdpbmRvdy5zZWxmIT09d2luZG93LnRvcH0sYUdUTS5mLmpzZXJyb3JzPWZ1bmN0aW9uKCl7YUdUTS5mLmV2THN0bih3aW5kb3csImVycm9yIiwoZnVuY3Rpb24oZSl7aWYobnVsbCE9PWUpe3ZhciB0PSJzdHJpbmciPT10eXBlb2YgZS5tZXNzYWdlP2UubWVzc2FnZToiIixhPSJzdHJpbmciPT10eXBlb2YgZS5maWxlbmFtZT9lLmZpbGVuYW1lOiIiO2lmKCJzY3JpcHQgZXJyb3IuIj09dC50b0xvd2VyQ2FzZSgpKXtpZighYSlyZXR1cm47dD10LnJlcGxhY2UoIi4iLCI6IikrIiBlcnJvciBmcm9tIG90aGVyIGRvbWFpbi4ifWEmJih0Kz0iIHwgZmlsZTogIithKTt2YXIgbj1hR1RNLmYuc3RyY2xlYW4oZS5saW5lbm8pOyIwIj09biYmKG49IiIpLG4mJih0Kz0iIHwgbGluZTogIituKTt2YXIgbz1hR1RNLmYuc3RyY2xlYW4oZS5jb2xubyk7IjAiPT1vJiYobz0iIiksbyYmKHQrPSIgfCBjb2w6ICIrbyksYUdUTS5kLmVycm9ycy5wdXNoKHQpO3ZhciByPSIiO3RyeXtyPW5hdmlnYXRvci5hcHBDb2RlTmFtZSsiIHwgIituYXZpZ2F0b3IuYXBwTmFtZSsiIHwgIituYXZpZ2F0b3IuYXBwVmVyc2lvbisiIHwgIituYXZpZ2F0b3IucGxhdGZvcm19Y2F0Y2goZSl7fWlmKGFHVE0uZC5lcnJvcl9jb3VudGVyKys+PTEwMClyZXR1cm47YUdUTS5kLmVycm9yX2NvdW50ZXI8PTUmJmFHVE0uZi5maXJlKHtldmVudDoiZXhjZXB0aW9uIixlcnJtc2c6dCxicm93c2VyOnIsZXJydHlwZToiSlMgRXJyb3IiLHRpbWVzdGFtcDoobmV3IERhdGUpLmdldFRpbWUoKSxlcnJjdDphR1RNLmQuZXJyb3JfY291bnRlcixldmVudE1vZGVsOm51bGx9KX19KSl9LGFHVE0uZi50aW1lcmZrdD1mdW5jdGlvbihlKXt2YXIgdD1KU09OLnBhcnNlKGFHVE0uZi5zU3RyZihlKSk7dC50aW1lcl9tcz0xKnQudGltZXJfbXMsdC50aW1lcl9jdCsrLHQudGltZXJfdG09dC50aW1lcl9tcyp0LnRpbWVyX2N0LHQudGltZXJfc2M9cGFyc2VGbG9hdCgodC50aW1lcl90bS8xZTMpLnRvRml4ZWQoMykpLHQuZXZlbnQ9dC5ldmVudHx8InRpbWVyIiwtMSE9PXQuZXZlbnQuaW5kZXhPZigiW3NdIikmJih0LmV2ZW50PXQuZXZlbnQucmVwbGFjZSgiW3NdIix0LnRpbWVyX3NjLnRvU3RyaW5nKCkpKSx0LmV2ZW50TW9kZWw9bnVsbCxhR1RNLmYuZmlyZSh0KX0sYUdUTS5mLnRpbWVyPWZ1bmN0aW9uKGUsdCxhLG4sbyl7aWYoIWUmJiJvYmplY3QiPT10eXBlb2YgYSYmYSYmInN0cmluZyI9PXR5cGVvZiBhLmV2ZW50JiYoZT1hLmV2ZW50KSxlPWV8fCJ0aW1lciIsZSs9Il8iKyhuZXcgRGF0ZSkuZ2V0VGltZSgpLnRvU3RyaW5nKCkrIl8iK01hdGguZmxvb3IoOTk5OTk5Kk1hdGgucmFuZG9tKCkrMSkudG9TdHJpbmcoKSxhR1RNLmYuc3RvcHRpbWVyKGUpLCJvYmplY3QiPT10eXBlb2YgYSYmYSl2YXIgcj1KU09OLnBhcnNlKGFHVE0uZi5zU3RyZihhKSk7ZWxzZSByPXt9O3IudGltZXJfbm09ZSxyLnRpbWVyX21zPW4sci50aW1lcl9ycD1vLHIudGltZXJfY3Q9MCxyLmlkPTE9PT1yLnRpbWVyX3JwP3NldFRpbWVvdXQoKGZ1bmN0aW9uKCl7dD90KHIpOmFHVE0uZi50aW1lcmZrdChyKX0pLG4pOnNldEludGVydmFsKChmdW5jdGlvbigpe3Q/dChyKTphR1RNLmYudGltZXJma3Qociksci50aW1lcl9jdCsrLHIudGltZXJfcnA+MCYmci50aW1lcl9jdD49ci50aW1lcl9ycCYmYUdUTS5mLnN0b3B0aW1lcihyLnRpbWVyX25tKX0pLG4pLGFHVE0uZC50aW1lcltlXT1yfSxhR1RNLmYuc3RvcHRpbWVyPWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiIT10eXBlb2YgYUdUTS5kLnRpbWVyJiYoYUdUTS5kLnRpbWVyPXt9KSwib2JqZWN0Ij09dHlwZW9mIGFHVE0uZC50aW1lcltlXSl7dmFyIHQ9YUdUTS5kLnRpbWVyW2VdO3QudGltZXJfcnA/Y2xlYXJJbnRlcnZhbCh0LmlkKTpjbGVhclRpbWVvdXQodC5pZCksZGVsZXRlIGFHVE0uZC50aW1lcltlXX19LGFHVE0uZi5pbml0PWZ1bmN0aW9uKCl7IWFHVE0uYy5kZWJ1ZyYmYUdUTS5mLm9wdG91dCgpfHwoYUdUTS5mLmNvbmZpZyhhR1RNLmMpLGFHVE0uYy5pZnJhbWVTdXBwb3J0JiZhR1RNLmQuaXNfaWZyYW1lPyhhR1RNLmQuY29uc2VudC5ndG1Db25zZW50PSEwLGFHVE0uZC5jb25zZW50Lmhhc1Jlc3BvbnNlPSEwLGFHVE0uZC5jb25zZW50LmZlZWRiYWNrPSJQYWdlIGlzIGlGcmFtZSIsYUdUTS5kLmlmcmFtZS5pZkxpc3Rlbnx8KGFHVE0uZC5pZnJhbWUuaWZMaXN0ZW49ITAsd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGFHVE0uZi5pZkhTbGlzdGVuKSksYUdUTS5kLmluaXR8fGFHVE0uZi5pbmplY3QoKSk6InN0cmluZyI9PXR5cGVvZiBhR1RNLmMuY21wJiZhR1RNLmMuY21wPyJub25lIj09YUdUTS5jLmNtcD8oYUdUTS5kLmNvbnNlbnQ9e2d0bUNvbnNlbnQ6ITAsaGFzUmVzcG9uc2U6ITAsZmVlZGJhY2s6Ik5vIENvbnNlbnQgQ2hlY2sgY29uZmlndXJlZCJ9LGFHVE0uZi5pbmplY3QoKSk6KGFHVE0uZi5sb2FkX2NjKGFHVE0uYy5jbXAsYUdUTS5mLmNvbnNlbnRfbGlzdGVuZXIpLGFHVE0uZi5pbml0R1RNKCEwKSk6KGFHVE0uZi5jb25zZW50X2xpc3RlbmVyKCksYUdUTS5mLmluaXRHVE0oITApKSxhR1RNLmYuanNlcnJvcnMoKSl9LGFHVE0uZi5zZW5kbmF1cz1mdW5jdGlvbihlKXtpZihlJiYib2JqZWN0Ij09dHlwZW9mIGUpe3dpbmRvd1thR1RNLmMuZ2RsXTt2YXIgdD13aW5kb3dbYUdUTS5jLmdkbF0ucHVzaDshYUdUTS5kLm9yaWdpbmFsRExwdXNoJiYvc2FuZGJveC9pLnRlc3QodC50b1N0cmluZygpKSYmKGFHVE0uZC5vcmlnaW5hbERMcHVzaD10KTt2YXIgYT0hMTthR1RNLmMuZGxPcmdQdXNoJiZhR1RNLmQub3JpZ2luYWxETHB1c2gmJmFHVE0uZC5vcmlnaW5hbERMcHVzaC50b1N0cmluZygpIT09dC50b1N0cmluZygpJiYoYT0hMCxhR1RNLmQuZGxIb29rTG9nZ2VkfHwoYUdUTS5kLm9yaWdpbmFsRExwdXNoKHtldmVudDoiZXhjZXB0aW9uIixlcnJ0eXBlOiJETCBFcnJvciIsZXJybXNnOiJGdW5jdGlvbiBkYXRhTGF5ZXIucHVzaCBob29rZWQgLSBubyBsb25nZXIgZnJvbSBHVE0iLGZjdF9ob29rOnQudG9TdHJpbmcoKSxmY3Rfb3JpZzphR1RNLmQub3JpZ2luYWxETHB1c2gudG9TdHJpbmcoKSx0aW1lc3RhbXA6KG5ldyBEYXRlKS5nZXRUaW1lKCksZXZlbnRNb2RlbDpudWxsfSksYUdUTS5kLmRsSG9va0xvZ2dlZD0hMCksInJlcGxhY2UiPT09YUdUTS5jLmRsT3JnUHVzaCYmKHdpbmRvd1thR1RNLmMuZ2RsXS5wdXNoPWFHVE0uZC5vcmlnaW5hbERMcHVzaCxhPSExKSksYSYmInVzZSI9PT1hR1RNLmMuZGxPcmdQdXNoP2FHVE0uZC5vcmlnaW5hbERMcHVzaChlKTp3aW5kb3dbYUdUTS5jLmdkbF0ucHVzaChlKSwiZnVuY3Rpb24iPT10eXBlb2YgYUdUTS5mLnNlbmRuYXVzX2NhbGxiYWNrJiZhR1RNLmYuc2VuZG5hdXNfY2FsbGJhY2soZSksYUdUTS5mLmxvZygibTkiLGUpfX0sYUdUTS5mLmZpcmU9ZnVuY3Rpb24oZSl7aWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlKXt0cnl7aWYoIShhPUpTT04ucGFyc2UoYUdUTS5mLnNTdHJmKGUpKSkpcmV0dXJuIHZvaWQgYUdUTS5mLmxvZygiZTE1IixhKX1jYXRjaChuKXt2YXIgdD0iYUdUTSBGaXJlIEVycm9yIChKU09OLnBhcnNlKSI7InN0cmluZyI9PXR5cGVvZiBlLmV2ZW50JiYodD10KyIgKEV2ZW50OiAiK2UuZXZlbnQrIikiKTt2YXIgYT17ZXZlbnQ6ImV4Y2VwdGlvbiIsZXJybXNnOm4ubWVzc2FnZSxlcnJ0eXBlOnQsdGltZXN0YW1wOihuZXcgRGF0ZSkuZ2V0VGltZSgpLGVycmN0OmFHVE0uZC5lcnJvcl9jb3VudGVyfHwxLGV2ZW50TW9kZWw6bnVsbH07YUdUTS5mLmxvZygiZTE1IixhKX1pZighKCJudW1iZXIiPT10eXBlb2YgYS5hR1RNdHN8fCJvYmplY3QiPT10eXBlb2YgYS5ldmVudE1vZGVsJiZhLmV2ZW50TW9kZWx8fCJzdHJpbmciIT10eXBlb2YgYS5ldmVudCYmInN0cmluZyI9PXR5cGVvZiBhLnR5cGUmJiJvYmplY3QiPT10eXBlb2YgYS5mbGFncyYmImJvb2xlYW4iPT10eXBlb2YgYS5mbGFncy5lbmFibGVVbnRhZ2dlZFBhZ2VSZXBvcnRpbmcmJmEuZmxhZ3MuZW5hYmxlVW50YWdnZWRQYWdlUmVwb3J0aW5nKSl7aWYoYS5hR1RNdHM9RGF0ZS5ub3coKSxhLmV2ZW50TW9kZWw9bnVsbCxhR1RNLmMuY29uc2VudF9ldmVudHMmJiJzdHJpbmciPT10eXBlb2YgYS5ldmVudCYmYUdUTS5jLmNvbnNlbnRfZXZlbnRzLmluZGV4T2YoIiwiK2EuZXZlbnQrIiwiKT49MClpZigib2JqZWN0Ij09dHlwZW9mIGFHVE0uYy5jb25zZW50X2V2ZW50X2F0dHJbYS5ldmVudF0pZm9yKHZhciBuIGluIGFHVE0uYy5jb25zZW50X2V2ZW50X2F0dHJbYS5ldmVudF0pdm9pZCAwIT09YVtuXSYmKGFHVE0uYy5jb25zZW50X2V2ZW50X2F0dHJbYS5ldmVudF1bbl0mJmFbbl0hPWFHVE0uYy5jb25zZW50X2V2ZW50X2F0dHJbYS5ldmVudF1bbl18fGFHVE0uZi5ydW5fY2MoInVwZGF0ZSIpKTtlbHNlIGFHVE0uZi5ydW5fY2MoInVwZGF0ZSIpO2lmKGFHVE0uYy5kbFNldCYmIm9iamVjdCI9PXR5cGVvZiBnb29nbGVfdGFnX21hbmFnZXImJiJvYmplY3QiPT10eXBlb2YgZ29vZ2xlX3RhZ19tYW5hZ2VyW2FHVE0uYy5ndG1JRF0mJk9iamVjdC5rZXlzKGFHVE0uYy5kbFNldCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIHQ9YUdUTS5jLmRsU2V0W2VdLG49Z29vZ2xlX3RhZ19tYW5hZ2VyW2FHVE0uYy5ndG1JRF1bYUdUTS5jLmdkbF0uZ2V0KHQpO3ZvaWQgMCE9PW4mJihhW2VdPW4pfSkpLCgib2JqZWN0IiE9dHlwZW9mIGFHVE0uZC5jb25zZW50fHwhYUdUTS5kLmNvbnNlbnQuaGFzUmVzcG9uc2V8fCFhR1RNLmQuY29uc2VudC5ndG1Db25zZW50KSYmKCJzdHJpbmciIT10eXBlb2YgYS5ldmVudHx8MCE9PWEuZXZlbnQuaW5kZXhPZigiYUdUTSIpKXx8YUdUTS5jLmlmcmFtZVN1cHBvcnQmJmFHVE0uZC5pc19pZnJhbWUmJiFhR1RNLmQuaWZyYW1lLm9yaWdpbilyZXR1cm4gZGVsZXRlIGEuYUdUTXRzLGRlbGV0ZSBhLmV2ZW50TW9kZWwsdm9pZCBhR1RNLmQuZi5wdXNoKEpTT04ucGFyc2UoYUdUTS5mLnNTdHJmKGEpKSk7KGFHVE0uZC5jb25zZW50Lmd0bUNvbnNlbnR8fCJzdHJpbmciPT10eXBlb2YgYS5ldmVudCYmMD09PWEuZXZlbnQuaW5kZXhPZigiYUdUTSIpKSYmKCJzdHJpbmciPT10eXBlb2YgYS5ldmVudCYmMD09PWEuZXZlbnQuaW5kZXhPZigiYUdUTSIpfHwoZGVsZXRlIGFbImd0bS51bmlxdWVFdmVudElkIl0sZGVsZXRlIGEuYUdUTXBhcmFtcyxhLmFHVE1wYXJhbXM9SlNPTi5wYXJzZShhR1RNLmYuc1N0cmYoYSkpKSxhR1RNLmQuZGwucHVzaChhKSxhR1RNLmMuaWZyYW1lU3VwcG9ydCYmYUdUTS5kLmlzX2lmcmFtZSYmInN0cmluZyI9PXR5cGVvZiBhLmV2ZW50P2FHVE0uZi5pRnJhbWVGaXJlKGEpOmFHVE0uZi5zZW5kbmF1cyhhKSksImZ1bmN0aW9uIj09dHlwZW9mIGFHVE0uZi5maXJlX2NhbGxiYWNrJiZhR1RNLmYuZmlyZV9jYWxsYmFjayhhKSxhR1RNLmYubG9nKCJtNyIsYSl9fWVsc2UgYUdUTS5mLmxvZygiZTkiLHtvOnR5cGVvZiBlfSl9Ow==');

// Build JS Code for response
var jsCode = agtm + cmp + config + 'aGTM.f.init();';

// Response
setResponseStatus(200);
setResponseHeader(aGTMversion);
setResponseBody(jsCode);
returnResponse();