___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "aGTM (v)Pageview and Page State Events",
  "brand": {
    "id": "brand_dummy",
    "displayName": "aGTM",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Advanced (v)Pageview with additional Client and Page information, a Bot detection and even a Human and AdBlock Detection ...",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "LABEL",
    "name": "note",
    "displayName": "\u003cp\u003eYou can use this Event not only to send a Pageview Event - you can use it also for sending DOMready or PAGEready events. Use the Drop Down field therefore.\u003cbr /\u003e\nDOMready fires after the Website DOM is fully loaded. PAGEready fires after the DOM and all other Website Ressources have loaded.\u003c/p\u003e"
  },
  {
    "type": "TEXT",
    "name": "eventname",
    "displayName": "Pageview Event Name",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "defaultValue": "vPageview"
  },
  {
    "type": "SELECT",
    "name": "pv_fire",
    "displayName": "When should the Pageview Event fire?",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "early",
        "displayValue": "As early as possible (after the trigger)"
      },
      {
        "value": "dom",
        "displayValue": "At DOMready"
      },
      {
        "value": "page",
        "displayValue": "At PAGEready"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "early"
  },
  {
    "type": "TEXT",
    "name": "max_fire",
    "displayName": "Maximum number of event firings",
    "simpleValueType": true,
    "defaultValue": 1,
    "valueHint": "0 for unlimited",
    "valueValidators": [
      {
        "type": "NON_NEGATIVE_NUMBER"
      }
    ],
    "help": "How many times should this event fire (for the same trigger and event name)? Set 0 for no limit."
  },
  {
    "type": "SIMPLE_TABLE",
    "name": "pv_attributes",
    "displayName": "Pageview Attributes",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Internal Field",
        "name": "pv_attribute",
        "type": "SELECT",
        "selectItems": [
          {
            "value": "f_pagetitle",
            "displayValue": "Page Title"
          },
          {
            "value": "f_canonical",
            "displayValue": "Value of the Canonical Tag"
          },
          {
            "value": "f_robots",
            "displayValue": "Value of the robots Tag"
          },
          {
            "value": "f_browser",
            "displayValue": "Browser Type"
          },
          {
            "value": "f_browser_version",
            "displayValue": "Browser Version"
          },
          {
            "value": "f_os",
            "displayValue": "Operating System"
          },
          {
            "value": "f_device",
            "displayValue": "Device Type"
          },
          {
            "value": "f_screen_width",
            "displayValue": "Monitor (Screen) Width in pixel"
          },
          {
            "value": "f_screen_height",
            "displayValue": "Monitor (Screen) Height in pixel"
          },
          {
            "value": "f_viewport_width",
            "displayValue": "Viewport Width in pixel"
          },
          {
            "value": "f_viewport_height",
            "displayValue": "Viewport Height in pixel"
          },
          {
            "value": "f_viewport_relation",
            "displayValue": "Viewport Relation (Height / Width)"
          },
          {
            "value": "f_page_width",
            "displayValue": "Document (Page) Width in pixel"
          },
          {
            "value": "f_page_height",
            "displayValue": "Document (Page) Height in pixel"
          },
          {
            "value": "f_locale",
            "displayValue": "Locale (Browser Language and Country)"
          },
          {
            "value": "f_js_ex_time",
            "displayValue": "Real JavaScript Execution Time of a 100ms delay"
          },
          {
            "value": "f_dnt",
            "displayValue": "Browser DoNotTrack (DNT) setting"
          },
          {
            "value": "f_cm",
            "displayValue": "Google Consent Mode Information (as object)"
          },
          {
            "value": "f_cmstr",
            "displayValue": "Google Consent Mode Information (as string)"
          },
          {
            "value": "f_count",
            "displayValue": "Event Counter"
          }
        ],
        "macrosInSelect": true
      },
      {
        "defaultValue": "",
        "displayName": "DataLayer Field Name",
        "name": "pv_dl_name",
        "type": "TEXT"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "use_js_check",
    "checkboxText": "Bot Detection with JS Execution Time Check",
    "simpleValueType": true,
    "help": "Note: The Bot Detection is always active. This setting is just to enable the JS Execution Time Check to have a better Bot Detection Result."
  },
  {
    "type": "GROUP",
    "name": "humanTest",
    "displayName": "Human Test",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "useHumanTest",
        "checkboxText": "Test, whether User is a Human ...",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "humanEvent",
        "displayName": "Human Check Event Name",
        "simpleValueType": true,
        "defaultValue": "human_check",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "humanField",
        "displayName": "Human Check DataLayer Field Name",
        "simpleValueType": true,
        "defaultValue": "human_detected",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "adblockTest",
    "displayName": "AdBlocker Test",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "useAdBlockTest",
        "checkboxText": "Test, whether AdBlocker is used",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "adblockEvent",
        "displayName": "AdBlock Check Event Name",
        "simpleValueType": true,
        "defaultValue": "adblock_check",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "adblockField",
        "displayName": "AdBlock Check DataLayer Field Name",
        "simpleValueType": true,
        "defaultValue": "adblock_detected",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "Cookie",
    "displayName": "Cookie Settings",
    "groupStyle": "ZIPPY_OPEN_ON_PARAM",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "useCookie",
        "checkboxText": "Use Cookie to avoid multiple Tests",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "cookieName",
        "displayName": "Name of the Cookie",
        "simpleValueType": true,
        "defaultValue": "_tr_Test_Result",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Import needed libraries
const log = require('logToConsole');
const JSON = require('JSON');
const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const copyFromDataLayer = require('copyFromDataLayer');
//const Object = require('Object');
const queryPermission = require('queryPermission');
const Math = require('Math');
const templateStorage = require('templateStorage');

/**
 * Build ND aGTM shadow object
 * @lastupdate 12.02.2024 by Andi Petzoldt <andi@petzoldt.net>
 * @author Andi Petzoldt <andi@petzoldt.net>
 * @property {object} o
 * @param {object} c - config
 *   @param {object} c.debug - debug messages in browser console
 * @param {object} d - data object
 *   @param {object} d.d - a copy of the sandbox data object
 *   @param {object} d.e - the current event object
 *   @param {object} d.q - event queue
 * @param {object} f - function library
 */
var o = o || { c: {debug:false}, d:{ d:data, e:{}, q:[] }, f:{}, l:[] };

// Get tag configuration
o.c.eventname = data.eventname;
o.c.pv_fire = data.pv_fire;
o.c.max_fire = o.c.max_fire || data.max_fire; if (typeof o.c.max_fire=='string') o.c.max_fire = o.c.max_fire * 1; if (typeof o.c.max_fire!='number' || o.c.max_fire===0) o.c.max_fire = 999;
o.c.pv_attributes = typeof data.pv_attributes=='object' ? data.pv_attributes : [];
o.c.use_js_check = typeof data.use_js_check=='boolean' ? data.use_js_check : false;
o.c.useHumanTest = typeof data.useHumanTest=='boolean' ? data.useHumanTest : false;
o.c.humanEvent = data.humanEvent;
o.c.humanField = data.humanField;
o.c.useAdBlockTest = typeof data.useAdBlockTest=='boolean' ? data.useAdBlockTest : false;
o.c.adblockEvent = data.adblockEvent;
o.c.adblockField = data.adblockField;
o.c.useCookie = typeof data.useCookie=='boolean' ? data.useCookie : false;
o.c.cookieName = data.cookieName;
//log('info','data',data);

// Define Bots
var bots = [
  'adsbot-google',
  'ahrefsbot',
  'applebot',
  'baiduspider',
  'bingbot',
  'bingpreview',
  'chrome-lighthouse',
  'chatgptbot',
  'crawl',
  'curl',
  'discordbot',
  'dotbot',
  'duckduckbot',
  'exabot',
  'facebookexternalhit',
  'facebot',
  'feedfetcher-google',
  'go-http-client',
  'google search console',
  'googlebot',
  'googlebot-image',
  'googlebot-news',
  'googlebot-video',
  'hubspot',
  'httpclient',
  'iascrawler',
  'internet-archive',
  'java',
  'jobboersebot',
  'libwww-perl',
  'linkedinbot',
  'links',
  'magpie-crawler',
  'mj12bot',
  'okhttp',
  'outbrain',
  'pagepeeker',
  'pinterestbot',
  'pingdompagespeed',
  'python-requests',
  'refindbot',
  'rogerbot',
  'samsungbot',
  'screaming frog seo spider',
  'semrushbot',
  'seznambot',
  'sistrix',
  'site-shot',
  'slackbot',
  'sogou',
  'telegrambot',
  'uptime robot',
  'wget',
  'wkhtmltoimage',
  'woobot',
  'yahoo! slurp',
  'yandexbot'
];

// Get browser userAgent data
var userAgent = callInWindow('aGTM.f.getVal','n','userAgent') || '';
if (userAgent) userAgent = userAgent.toLowerCase();
var userAgentData = callInWindow('aGTM.f.getVal','n','userAgentData') || null;
templateStorage.setItem('useHumanTest', 1);

// Initiate variables
o.d.viewport_width = 0;
o.d.viewport_height = 0;
o.d.viewport_relation = 1;
o.d.document_width = 0;
o.d.document_height = 0;
o.d.os = '';
o.d.device_type = '';
o.d.browser_type = '';
o.d.browser_version = '';
var e = { event: o.c.eventname };

// Initiate Counter
if (typeof templateStorage.getItem('pv_ctr')!='object' || !templateStorage.getItem('pv_ctr')) templateStorage.setItem('pv_ctr', {});
o.d.counter_obj = templateStorage.getItem('pv_ctr');
o.d.trigger_event = copyFromDataLayer('event');
o.d.counter_name = o.d.trigger_event + '_' + o.c.eventname;
if (typeof o.d.counter_obj[o.d.counter_name]!='number') o.d.counter_obj[o.d.counter_name] = 0;
o.d.counter_obj[o.d.counter_name] = o.d.counter_obj[o.d.counter_name] + 1;
templateStorage.setItem('pv_ctr', JSON.parse(JSON.stringify(o.d.counter_obj)));
var counter = o.d.counter_obj[o.d.counter_name];

/**
 * Get DoNotTrack (DNT) Setting
 * Usage: o.f.getDNT();
 */
o.f.getDNT = function() {
  var dnt = callInWindow('aGTM.f.getVal','n','doNotTrack') || null;
  if (!dnt) dnt = callInWindow('aGTM.f.getVal','w','doNotTrack') || null;
  return dnt ? true : false;
};

// Hilfsfunktion für den Status-Text
function getCMstatus(status) {
  return status === undefined ? false : status ? true : false;
}

/**
 * Get Consent Mode Signals
 * Usage: o.f.getCM();
 */
o.f.getCM = function() {
  var cmo = {};
  var cm = callInWindow('aGTM.f.getVal', 'c', 'all') || null;
  if (!cm) return cmo;
  cmo.active = cm.active || false;
  cmo.usedDefault = cm.usedDefault || false;
  cmo.usedImplicit = cm.usedImplicit || false;
  cmo.usedUpdate = cm.usedUpdate || false;
  cmo.region = '';
  cmo.entries = {};
  if (cm.entries) {
    var ens = cm.entries;
    var firstKey;
    for (firstKey in ens) {
      if (ens.hasOwnProperty(firstKey)) {
        break;
      }
    }
    if (firstKey && ens[firstKey].region) {
      cmo.region = ens[firstKey].region;
    }
    for (var cat in ens) {
      if (ens.hasOwnProperty(cat)) {
        var defaultStatus = getCMstatus(ens[cat].default);
        var updateStatus = getCMstatus(ens[cat].update);
        var implicitStatus = getCMstatus(ens[cat].implicit);
        var currentStatus = updateStatus ? updateStatus : defaultStatus;
        currentStatus = currentStatus || implicitStatus;

        // Wenn weder "default" noch "update" noch "implicit" gesetzt sind, diesen Eintrag überspringen
        if (typeof currentStatus == 'boolean') {
          cmo.entries[cat] = currentStatus;
        }
      }
    }
  }
  return cmo;
};
o.d.cm = null;

/**
 * Define function to get the sizes of the document and the viewport
 * Usage: o.f.getDims();
 */
o.f.getDims = function() {
  // Get Document and Viewport Size
  o.d.viewport_width=callInWindow('aGTM.f.getVal','w','innerWidth');
  o.d.viewport_height=callInWindow('aGTM.f.getVal','w','innerHeight');
  var offsetWidth=callInWindow('aGTM.f.getVal','b','offsetWidth');
  var offsetHeight=callInWindow('aGTM.f.getVal','b','offsetHeight');
  var clientWidth=callInWindow('aGTM.f.getVal','b','clientWidth');
  var clientHeight=callInWindow('aGTM.f.getVal','b','clientHeight');
  var scrollWidth=callInWindow('aGTM.f.getVal','b','scrollWidth');
  var scrollHeight=callInWindow('aGTM.f.getVal','b','scrollHeight');
  if(typeof offsetHeight=='number') {
    o.d.document_width = offsetWidth;
    o.d.document_height = offsetHeight;
  }
  if(typeof clientHeight=='number' && clientHeight>o.d.document_height) {
    o.d.document_width = clientWidth;
    o.d.document_height = clientHeight;
  }
  if(typeof scrollHeight=='number' && scrollHeight>o.d.document_height) {
    o.d.document_width = scrollWidth;
    o.d.document_height = scrollHeight;
  }
  if(o.d.viewport_height>0){
    o.d.viewport_relation = Math.round( o.d.document_height / o.d.viewport_height );
  }
};

/**
 * Define function to check whether the User is a Bot (using the userAgent)
 * Usage: o.f.checkForBots();
 */
o.f.checkForBots = function() {
  // Check User-Agent for known bot patterns
  for (var i = 0; i < bots.length; i++) {
    if (callInWindow('aGTM.f.rTest', userAgent, bots[i])) {
      return bots[i];
    }
  }
  // General check for common bot terms in User-Agent
  if (callInWindow('aGTM.f.rTest', userAgent, 'crawler|spider|bot')) {
    return 'Bot (generic)';
  }
  // Check User-Agent Client Hints for known bot patterns
  if (userAgentData) {
    var brands = userAgentData.brands;
    for (var l = 0; l < brands.length; l++) {
      for (var j = 0; j < bots.length; j++) {
        if (callInWindow('aGTM.f.rTest', brands[l].brand.toLowerCase(), bots[j])) {
          return bots[j];
        }
      }
    }
    // General check for common bot terms in User-Agent Client Hints
    if (userAgentData.mobile === false && userAgentData.platform === 'bot') {
      return 'Bot (generic)';
    }
  }
  // Check for known headless browsers in User-Agent string
  if (callInWindow('aGTM.f.rTest', userAgent, 'headlesschrome|phantomjs')) {
    var bt = 'Headless Chrome or Phantom JS';
    var browserMatch = callInWindow('aGTM.f.rMatch', userAgent, 'headlesschrome|phantomjs') || [];
    if (browserMatch) bt = browserMatch[0];
    return bt;
  }
  // Check Browser setting Webdriver
  if (callInWindow('aGTM.f.getVal','n','webdriver')) {
    return 'Bot (webdriver)';
  }
  // Check WebGL renderer info
  //var canvas = document.createElement('canvas');
  //var gl = canvas ? canvas.getContext('webgl') : null;
  //if (gl) {
  //  var debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
  //  var vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
  //  var renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
  //  if (vendor === "Brian Paul" && renderer === "Mesa OffScreen") {
  //    window.deviceInfo.deviceType = 'Bot';
  //    window.deviceInfo.browser = 'headlesschrome-webgl';
  //    return;
  //  }
  //}
  // Check screen dimensions
  o.d.screen_width = callInWindow('aGTM.f.getVal','m','width') || 0;
  if (!o.d.screen_width) o.d.screen_width = callInWindow('aGTM.f.getVal','w','outerWidth') || 0;
  o.d.screen_height = callInWindow('aGTM.f.getVal','m','height') || 0;
  if (!o.d.screen_height) o.d.screen_height = callInWindow('aGTM.f.getVal','w','outerHeight') || 0;
  if (o.d.screen_width <= 100 && o.d.screen_height <= 100) {
    return 'Bot (no_monitor)';
  }
  // Return null, if no bot was detected
  return null;
};

/**
 * Define function to get browser info
 * Usage: o.f.checkDeviceInfo();
 */
o.f.checkDeviceInfo = function() {
  // Set defaults
  o.d.os = 'Other';
  o.d.device_type = 'Desktop';
  o.d.browser_type = 'Other';
  o.d.browser_version = 'Unknown';
  // Check if it's a bot
  var botName = o.f.checkForBots();
  if (botName) {
    o.d.device_type = 'Bot';
    o.d.browser_type = botName;
    o.d.os = 'Bot OS';
    //return;
  }
  // Determine device type
  if (callInWindow('aGTM.f.rTest', userAgent, 'mobi|android|touch|tablet') && o.d.device_type!='Bot') {
    o.d.device_type = 'Mobile';
  } else if (o.d.device_type!='Bot') {
    o.d.device_type = 'Desktop';
  }
  // Determine operating system
  if (callInWindow('aGTM.f.rTest', userAgent, 'windows nt')) {
    o.d.os = 'Windows';
  } else if (callInWindow('aGTM.f.rTest', userAgent, 'mac os x')) {
    o.d.os = 'MacOS';
  } else if (callInWindow('aGTM.f.rTest', userAgent, 'android')) {
    o.d.os = 'Android';
  } else if (callInWindow('aGTM.f.rTest', userAgent, 'linux')) {
    o.d.os = 'Linux';
  } else if (callInWindow('aGTM.f.rTest', userAgent, 'iphone|ipad|ipod')) {
    o.d.os = 'iOS';
  } else {
    // Extract OS from User-Agent or Client Hints if available
    if (userAgentData && userAgentData.platform) {
      o.d.os = userAgentData.platform;
    } else {
      var osMatch = callInWindow('aGTM.f.rMatch', userAgent, '\\(([^;]+);') || [];
      o.d.os = osMatch.length > 1 ? osMatch[1] : 'Unknown OS';
    }
  }
  // Determine browser type and version
  var browserMatch = callInWindow('aGTM.f.rMatch', userAgent, '(brave|arc|tor browser|opera|opr|samsungbrowser|chrome|crios|crmo|firefox|fxios|safari|msie|trident|edg|wv)\\/?\\s*(\\d+)') || [];
  if (browserMatch.length > 2) {
    var browserName = browserMatch[1];
    var browserVersion = browserMatch[2];

    // Adjust for specific browser names and versions
    if (callInWindow('aGTM.f.rTest', browserName, 'trident')) {
      browserName = 'Internet Explorer';
      var versionMatch = callInWindow('aGTM.f.rMatch', userAgent, '\\brv[ :]+(\\d+)') || [];
      if (versionMatch.length > 1) {
        browserVersion = versionMatch[1];
      }
    } else if (callInWindow('aGTM.f.rTest', browserName, 'chrome|crios|crmo')) {
      browserName = 'Chrome';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'firefox|fxios')) {
      browserName = 'Firefox';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'safari') && !callInWindow('aGTM.f.rTest', userAgent, 'chrome|crios|crmo')) {
      browserName = 'Safari';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'edg')) {
      browserName = 'Edge';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'opera|opr')) {
      browserName = 'Opera';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'samsungbrowser')) {
      browserName = 'Samsung Browser';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'brave')) {
      browserName = 'Brave';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'arc')) {
      browserName = 'Arc';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'tor browser')) {
      browserName = 'Tor Browser';
    } else if (callInWindow('aGTM.f.rTest', browserName, 'wv')) {
      browserName = 'Android WebView';
    } else if (callInWindow('aGTM.f.rTest', userAgent, 'FBAN') || callInWindow('aGTM.f.rTest', userAgent, 'FBAV')) {
      browserName = 'Facebook In-App Browser';
    } else if (callInWindow('aGTM.f.rTest', userAgent, 'Instagram')) {
      browserName = 'Instagram In-App Browser';
    }
    o.d.browser_type = browserName;
    o.d.browser_version = browserVersion;
  } else {
    // Extract Browser from User-Agent or Client Hints if available
    if (userAgentData && userAgentData.brands) {
      var brand = userAgentData.brands[0];
      o.d.browser_type = brand.brand;
      o.d.browser_version = brand.version;
    } else {
      var browserMatchFallback = callInWindow('aGTM.f.rMatch', userAgent, '([a-zA-Z]+)/([0-9\\.]+)') || [];
      if (browserMatchFallback.length > 2) {
        o.d.browser_type = browserMatchFallback[1];
        o.d.browser_version = browserMatchFallback[2];
      } else {
        o.d.browser_type = 'Unknown Browser';
        o.d.browser_version = '';
      }
    }
  }
};

// Function to check JS excecution time for Bot detection
o.f.checkExecutionTiming = function() {
  var endTime = callInWindow('aGTM.f.getVal','p','now') || 0;
  // If the time span between start and end is more than 1000 ms, it might be a bot
  if (!o.c.bottest_jsexct) o.c.bottest_jsexct = 'bottest_jsexct';
  e[o.c.bottest_jsexct] = o.d.js_ex_time = endTime - o.d.startTime;
  if (o.d.js_ex_time < 25 || o.d.js_ex_time > 10000) {
    e.device = o.d.device_type = 'Bot (JS Time)';
    //e.os = o.d.os = 'Bot OS';
    //e.browser = o.d.browser_type = 'Bot (wrong JS excecution time)';
  }
  // Send data
  o.f.fire(e);
};

/**
 * Add or remove Human Event Listener
 * @param {string} mode - mode ('add' for addEventListener, 'rem' for removeEventListener)
 * Usage: o.f.handleEventListener('add');
 */
o.f.handleEventListener = function(mode) {
  // Define Human Events
  var events = ['mousemove', 'keydown', 'scroll', 'touchstart'];
  // Handle Event Listener
  for (var i=0; i<events.length; i++) {
    var t = mode=='rem' ? 'aGTM.f.rmLstn' : 'aGTM.f.evLstn';
    callInWindow(t,'window',events[i],o.f.handleUserInteraction);
  }
};

// Function to handle user interactions
o.f.handleUserInteraction = function() {
  if (templateStorage.getItem('useHumanTest')) {
    //o.c.useHumanTest = false;
    templateStorage.setItem('useHumanTest', 0);
    var he = { event:o.c.humanEvent };
    he[o.c.humanField] = 1;
    callInWindow('aGTM.f.fire', he);
    //o.f.handleEventListener('rem'); // Remove event listeners to improve performance
  }
};

/**
 * Define function to get AdBlocker Test pixel
 * Usage: o.f.getABpixel();
 */
o.f.getABpixel = function() {
  var adBlock = 1;
  var pixel = callInWindow('aGTM.f.getNodeAttr','div#adBlockTest','id');
  if (pixel) {
    callInWindow('aGTM.f.delNode','div#adBlockTest');
    adBlock = 0;
  }
  var ae = { event:o.c.adblockEvent };
  ae[o.c.adblockField] = adBlock;
  callInWindow('aGTM.f.fire', ae);
};

// Get Browser Info and Dimensions and add Listener
o.f.checkDeviceInfo();
o.f.getDims();
callInWindow('aGTM.f.evLstn','window','resize',o.f.getDims);

// Prepare event
o.c.bottest_jsexct = '';
o.c.pv_attributes.forEach(function(row) {
  switch (row.pv_attribute) {
    case 'f_pagetitle': e[row.pv_dl_name] = callInWindow('aGTM.f.getVal','d','title') || '';
                        break;
    case 'f_canonical': e[row.pv_dl_name] = callInWindow('aGTM.f.getNodeAttr','link[rel="canonical"]','href') || '';
                        break;
    case 'f_robots': e[row.pv_dl_name] = callInWindow('aGTM.f.getNodeAttr','meta[name="robots"]','content') || '';
                     break;
    case 'f_browser': if (!o.d.browser_type) o.f.checkDeviceInfo();
                      e[row.pv_dl_name] = o.d.browser_type;
                      break;
    case 'f_browser_version': if (!o.d.browser_version) o.f.checkDeviceInfo();
                              e[row.pv_dl_name] = o.d.browser_version;
                              break;
    case 'f_os': if (!o.d.os) o.f.checkDeviceInfo();
                 e[row.pv_dl_name] = o.d.os;
                 break;
    case 'f_device': if (!o.d.device_type) o.f.checkDeviceInfo();
                     e[row.pv_dl_name] = o.d.device_type;
                     break;
    case 'f_screen_width': if (!o.d.screen_width) o.f.getDims();
                           e[row.pv_dl_name] = o.d.screen_width;
                           break;
    case 'f_screen_height': if (!o.d.screen_height) o.f.getDims();
                            e[row.pv_dl_name] = o.d.screen_height;
                            break;
    case 'f_viewport_width': if (!o.d.viewport_width) o.f.getDims();
                             e[row.pv_dl_name] = o.d.viewport_width;
                             break;
    case 'f_viewport_height': if (!o.d.viewport_height) o.f.getDims();
                              e[row.pv_dl_name] = o.d.viewport_height;
                              break;
    case 'f_viewport_relation': if (!o.d.viewport_relation || o.d.viewport_relation===1) o.f.getDims();
                                e[row.pv_dl_name] = o.d.viewport_relation;
                                break;
    case 'f_page_width': if (!o.d.document_width) o.f.getDims();
                         e[row.pv_dl_name] = o.d.document_width;
                         break;
    case 'f_page_height': if (!o.d.document_height) o.f.getDims();
                          e[row.pv_dl_name] = o.d.document_height;
                          break;
    case 'f_locale': e[row.pv_dl_name] = callInWindow('aGTM.f.getVal','n','language') || '';
                     break;
    case 'f_js_ex_time': o.c.bottest_jsexct = row.pv_dl_name;
                         break;
    case 'f_dnt': e[row.pv_dl_name] = o.f.getDNT() || false;
                  break;
    case 'f_cm': if (!o.d.cm) o.d.cm = o.f.getCM();
                 e[row.pv_dl_name] = o.d.cm;
                 break;
    case 'f_cmstr': if (!o.d.cm) o.d.cm = o.f.getCM();
                    e[row.pv_dl_name] = JSON.stringify(o.d.cm);
                    break;
    case 'f_count': e[row.pv_dl_name] = counter;
                    break;
    default: e[row.pv_dl_name] = row.pv_attribute;
  }
  e[row.pkey] = row.pvalue;
});

// Fire Function
o.f.fire = function (e) {
  switch (o.c.pv_fire) {
    case 'dom': callInWindow('aGTM.f.domready', JSON.parse(JSON.stringify(e)));
                break;
    case 'page': callInWindow('aGTM.f.pageready', JSON.parse(JSON.stringify(e)));
                 break;
    default: callInWindow('aGTM.f.fire', JSON.parse(JSON.stringify(e)));
  }
  o.d.q.push(e);
};

// Get Cookie
if (o.c.useCookie) {
  var cv = callInWindow('aGTM.f.gc',o.c.cookieName);
  if (typeof cv=='string' && cv=='1') {
    o.c.use_js_check = false;
    o.c.useHumanTest = false;
    o.c.useAdBlockTest = false;
  } else {
    callInWindow('aGTM.f.sc',o.c.cookieName,'1');
  }
}

// Human Test
if (counter<=o.c.max_fire && o.c.useHumanTest && templateStorage.getItem('useHumanTest')) {
  o.f.handleEventListener('add');
}

// Push event function
if (counter<=o.c.max_fire && ((o.c.use_js_check && o.d.device_type!='Bot') || o.c.bottest_jsexct)) {
  if (!o.c.bottest_jsexct) o.c.bottest_jsexct = 'bottest_jsexct';
  o.d.startTime = callInWindow('aGTM.f.getVal','p','now') || 0;
  callInWindow('aGTM.f.timer', o.c.bottest_jsexct, o.f.checkExecutionTiming, {}, 100, 1);
} else if (counter<=o.c.max_fire) {
  o.f.fire(e);
}

// Inject Ad Blocker Test Pixel
if (counter<=o.c.max_fire && o.c.useAdBlockTest) {
  // Insert test pixel
  callInWindow('aGTM.f.newNode','div','body',{ textContent:' ', id:'adBlockTest', className:'adsbygoogle', 'style.width':'1px', 'style.height':'1px', 'style.display':'none' });
  callInWindow('aGTM.f.timer', 'adbltest', o.f.getABpixel, {}, 1000, 1);
}


// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.fire"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.getVal"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.evLstn"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.pageinfo"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.getNodeAttr"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.newNode"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.delNode"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.sc"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.gc"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.timer"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.rMatch"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.rTest"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.domready"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "aGTM.f.pageready"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

# aGTM Custom Template

- Version 1.0
- Autor: Andi Petzoldt <andi@petzoldt.net>
- Last Update: 02.06.2024

## Description

Custom GTM Template to send a vPageview with additional information about the client and the page.
Like browser, bot-detection, what is the page title or the canonical tag, ...


